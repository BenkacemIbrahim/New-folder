<section class="projects-list-page">
  <app-page-header
    [eyebrow]="'PROJECTS.EYEBROW' | translate"
    [title]="'PROJECTS.TITLE' | translate"
    [actionLabel]="
      (filterMenuOpen() ? 'PROJECTS.ACTIONS.CLOSE_FILTERS' : 'PROJECTS.ACTIONS.OPEN_FILTERS') | translate
    "
    actionIcon="filter_list"
    (action)="toggleFilterMenu()"
  />

  <section class="filter-drop" [class.open]="filterMenuOpen()" [attr.aria-hidden]="!filterMenuOpen()">
    <div class="filter-top-row">
      <label class="search-shell">
        <mat-icon>search</mat-icon>
        <input
          type="search"
          [placeholder]="'PROJECTS.SEARCH_PLACEHOLDER' | translate"
          [value]="searchTerm()"
          (input)="setSearchTerm($any($event.target).value)"
        />
      </label>

      <button
        type="button"
        class="date-sort-btn"
        [class.asc]="dateSortDirection() === 'asc'"
        [attr.data-direction]="dateSortDirection()"
        (click)="toggleDateSortDirection()"
      >
        <span>{{ 'PROJECTS.DUE_DATE' | translate }}</span>
        <span class="sort-split-icon" [attr.data-direction]="dateSortDirection()" aria-hidden="true">
          <span class="arrow up">&uarr;</span>
          <span class="arrow down">&darr;</span>
        </span>
      </button>
    </div>

    <div class="filter-row">
      <button
        type="button"
        *ngFor="let filter of statusFilters"
        class="filter-chip"
        [ngClass]="{ active: selectedFilter() === filter }"
        (click)="setFilter(filter)"
      >
        {{ statusFilterLabelKey(filter) | translate }}
      </button>
    </div>
  </section>

  <section class="projects-grid" [@listFilterAnimation]="listAnimationState()">
    <article class="project-card" *ngFor="let project of filteredProjects(); trackBy: trackByProject">
      <header class="card-header">
        <p class="project-key">{{ project.key }}</p>
        <app-project-status-badge [status]="project.status" />
      </header>

      <a [routerLink]="['/projects', project.id]" class="project-name">{{ project.name }}</a>
      <p class="summary">{{ project.summary }}</p>

      <div class="meta-grid">
        <p><span>{{ 'PROJECTS.META.OWNER' | translate }}</span>{{ project.owner }}</p>
        <p><span>{{ 'PROJECTS.META.DUE' | translate }}</span>{{ project.dueDate | date: 'MMM d, y' : undefined : locale() }}</p>
        <p><span>{{ 'PROJECTS.META.TEAM' | translate }}</span>{{ 'PROJECTS.META.TEAM_MEMBERS' | translate: { count: project.teamSize } }}</p>
        <p><span>{{ 'PROJECTS.META.PRODUCTIVITY' | translate }}</span>{{ 'PROJECTS.META.PRODUCTIVITY_POINTS' | translate: { value: project.productivity } }}</p>
      </div>

      <div class="progress-shell">
        <div class="progress-track">
          <span [style.width.%]="project.progress"></span>
        </div>
        <p>{{ 'PROJECTS.PROGRESS' | translate: { value: project.progress } }}</p>
      </div>
    </article>
  </section>

  <section class="empty-state" *ngIf="!loading() && filteredProjects().length === 0">
    <mat-icon>filter_alt_off</mat-icon>
    <h3>{{ 'PROJECTS.EMPTY_STATE.TITLE' | translate }}</h3>
    <p>{{ 'PROJECTS.EMPTY_STATE.DESCRIPTION' | translate }}</p>
  </section>
</section>

<app-project-modal
  *ngIf="createModalOpen()"
  [title]="'PROJECTS.CREATE_MODAL.TITLE' | translate"
  [subtitle]="'PROJECTS.CREATE_MODAL.SUBTITLE' | translate"
  (closed)="closeCreateModal()"
>
  <form class="project-form" [formGroup]="createProjectForm" (ngSubmit)="createProject()" novalidate>
    <div class="form-grid">
      <label>
        <span>{{ 'PROJECTS.FIELDS.PROJECT_NAME' | translate }}</span>
        <input type="text" formControlName="name" [placeholder]="'PROJECTS.PLACEHOLDERS.PROJECT_NAME' | translate" />
        <p class="form-error" *ngIf="hasControlError('name')" [@formErrorAnimation]>
          {{ controlErrorText('name') | translate }}
        </p>
      </label>

      <label>
        <span>{{ 'PROJECTS.FIELDS.OWNER' | translate }}</span>
        <input type="text" formControlName="owner" [placeholder]="'PROJECTS.PLACEHOLDERS.OWNER' | translate" />
        <p class="form-error" *ngIf="hasControlError('owner')" [@formErrorAnimation]>
          {{ controlErrorText('owner') | translate }}
        </p>
      </label>

      <label>
        <span>{{ 'PROJECTS.FIELDS.STATUS' | translate }}</span>
        <select formControlName="status">
          <option value="On Track">{{ 'PROJECTS.STATUS.ON_TRACK' | translate }}</option>
          <option value="At Risk">{{ 'PROJECTS.STATUS.AT_RISK' | translate }}</option>
          <option value="Blocked">{{ 'PROJECTS.STATUS.BLOCKED' | translate }}</option>
        </select>
      </label>

      <label>
        <span>{{ 'PROJECTS.FIELDS.DUE_DATE' | translate }}</span>
        <input type="date" formControlName="dueDate" />
        <p class="form-error" *ngIf="hasControlError('dueDate')" [@formErrorAnimation]>
          {{ controlErrorText('dueDate') | translate }}
        </p>
      </label>
    </div>

    <label class="summary-field">
      <span>{{ 'PROJECTS.FIELDS.SUMMARY' | translate }}</span>
      <textarea formControlName="summary" rows="4" [placeholder]="'PROJECTS.PLACEHOLDERS.SUMMARY' | translate"></textarea>
      <p class="form-error" *ngIf="hasControlError('summary')" [@formErrorAnimation]>
        {{ controlErrorText('summary') | translate }}
      </p>
    </label>

    <p class="form-error form-level" *ngIf="formError()" [@formErrorAnimation]>{{ formError() | translate }}</p>

    <div class="form-actions">
      <button type="button" class="secondary-btn" (click)="closeCreateModal()">
        {{ 'COMMON.ACTIONS.CANCEL' | translate }}
      </button>
      <button type="submit" class="primary-btn" [disabled]="submitting()">
        {{ (submitting() ? 'PROJECTS.ACTIONS.CREATING' : 'PROJECTS.ACTIONS.CREATE_PROJECT') | translate }}
      </button>
    </div>
  </form>
</app-project-modal>
