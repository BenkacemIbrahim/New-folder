<header class="tasks-title-row">
  <div class="title-copy">
    <p class="eyebrow">{{ 'TASKS.EYEBROW' | translate }}</p>
    <h1>{{ 'TASKS.TITLE' | translate }}</h1>
  </div>
  <p class="flow-count">{{ 'TASKS.FLOW_COUNT' | translate: { count: totalTasks() } }}</p>
</header>

<section class="kanban-board" cdkDropListGroup>
  <article
    class="kanban-column"
    *ngFor="let column of columns; trackBy: trackByColumn"
    [class.drop-feedback]="dropFeedbackColumn() === column.key"
  >
    <header class="column-header">
      <div>
        <p class="column-title">{{ column.title | translate }}</p>
        <p class="column-subtitle">{{ column.subtitle | translate }}</p>
      </div>
      <span class="count-pill">{{ columnCount(column.key) }}</span>
    </header>

    <div class="column-feedback" *ngIf="dropFeedbackColumn() === column.key" [@dropPulseAnimation]></div>

    <section
      class="task-list"
      cdkDropList
      [id]="column.key"
      [cdkDropListData]="getTasksForColumn(column.key)"
      [cdkDropListConnectedTo]="connectedDropLists"
      (cdkDropListDropped)="drop($event, column.key)"
    >
      <article
        class="task-card"
        *ngFor="let task of getTasksForColumn(column.key); trackBy: trackByTask; let index = index"
        cdkDrag
        [cdkDragData]="task"
        [style.animationDelay.ms]="index * 55"
        (click)="openTask(task.id)"
      >
        <span class="priority-indicator" [ngClass]="priorityClass(task)"></span>

        <div class="task-top">
          <p class="task-id">{{ task.id }}</p>
          <span class="points">{{ 'TASKS.STORY_POINTS' | translate: { points: task.storyPoints } }}</span>
        </div>

        <h3>{{ task.title | translate }}</h3>
        <p class="summary">{{ task.summary | translate }}</p>

        <div class="tag-row">
          <span class="tag" *ngFor="let tag of task.tags">{{ tag | translate }}</span>
        </div>

        <footer class="task-footer">
          <div class="assignee">
            <span class="avatar">{{ task.assigneeInitials }}</span>
            <span>{{ task.assignee }}</span>
          </div>
          <time>{{ task.dueDate | date: 'MMM d' : undefined : locale() }}</time>
        </footer>
      </article>
    </section>
  </article>
</section>

<div
  class="drawer-layer"
  *ngIf="selectedTask() as task"
  [@drawerBackdropAnimation]
  (click)="closeDrawer()"
>
  <aside class="task-drawer" [@drawerSlideAnimation] (click)="$event.stopPropagation()">
    <header class="drawer-header">
      <div>
        <p class="drawer-id">{{ task.id }}</p>
        <h3>{{ task.title | translate }}</h3>
      </div>
      <button
        type="button"
        class="close-btn"
        [attr.aria-label]="'TASKS.DRAWER.CLOSE' | translate"
        (click)="closeDrawer()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </header>

    <section class="drawer-content">
      <article class="detail-block">
        <h4>{{ 'TASKS.DRAWER.SUMMARY' | translate }}</h4>
        <p>{{ task.summary | translate }}</p>
      </article>

      <article class="detail-grid">
        <div>
          <p class="label">{{ 'TASKS.DRAWER.STATUS' | translate }}</p>
          <p class="value">{{ statusLabelKey(task.status) | translate }}</p>
        </div>
        <div>
          <p class="label">{{ 'TASKS.DRAWER.PRIORITY' | translate }}</p>
          <p class="value">{{ priorityLabelKey(task.priority) | translate }}</p>
        </div>
        <div>
          <p class="label">{{ 'TASKS.DRAWER.ASSIGNEE' | translate }}</p>
          <p class="value">{{ task.assignee }}</p>
        </div>
        <div>
          <p class="label">{{ 'TASKS.DRAWER.STORY_POINTS' | translate }}</p>
          <p class="value">{{ task.storyPoints }}</p>
        </div>
        <div>
          <p class="label">{{ 'TASKS.DRAWER.DUE_DATE' | translate }}</p>
          <p class="value">{{ task.dueDate | date: 'MMM d, y' : undefined : locale() }}</p>
        </div>
        <div>
          <p class="label">{{ 'TASKS.DRAWER.UPDATED' | translate }}</p>
          <p class="value">{{ task.updatedAt | date: 'MMM d, y, h:mm a' : undefined : locale() }}</p>
        </div>
      </article>

      <article class="detail-block">
        <h4>{{ 'TASKS.DRAWER.DELIVERY_TAGS' | translate }}</h4>
        <div class="tag-row">
          <span class="tag" *ngFor="let tag of task.tags">{{ tag | translate }}</span>
        </div>
      </article>
    </section>
  </aside>
</div>
